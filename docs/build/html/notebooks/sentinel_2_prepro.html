<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>Preprocessing Sentinel-2 images - eo-toolbox 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">eo-toolbox 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">eo-toolbox 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents </span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="region_of_interest.html">Region of Interest</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Preprocessing-Sentinel-2-images">
<h1>Preprocessing Sentinel-2 images<a class="headerlink" href="#Preprocessing-Sentinel-2-images" title="Permalink to this headline">#</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">rasterio.mask</span>
<span class="kn">import</span> <span class="nn">rasterio.plot</span>
<span class="kn">from</span> <span class="nn">rasterio.enums</span> <span class="kn">import</span> <span class="n">Resampling</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'All libraries successfully imported!'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Rasterio : </span><span class="si">{</span><span class="n">rasterio</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
All libraries successfully imported!
Rasterio : 1.0.8
</pre></div></div>
</div>
<section id="Set-directory">
<h2>Set directory<a class="headerlink" href="#Set-directory" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">computer_path</span> <span class="o">=</span> <span class="s1">'/export/miro/ndeffense/LBRAT2104/'</span>
<span class="n">grp_letter</span>    <span class="o">=</span> <span class="s1">'X'</span>

<span class="c1"># Directory for all work files</span>
<span class="n">work_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">computer_path</span><span class="si">}</span><span class="s1">GROUP_</span><span class="si">{</span><span class="n">grp_letter</span><span class="si">}</span><span class="s1">/WORK/'</span>

<span class="n">roi_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">work_path</span><span class="si">}</span><span class="s1">ROI/'</span>
<span class="n">dwl_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">work_path</span><span class="si">}</span><span class="s1">DOWNLOAD/'</span>


<span class="c1"># For each step of the preprocessing,</span>
<span class="c1"># a folder will be created to store</span>
<span class="c1"># the intermediary files.</span>

<span class="n">resampled_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">work_path</span><span class="si">}</span><span class="s1">1_L2A_RESAMPLED/'</span>
<span class="n">clipped_path</span>   <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">work_path</span><span class="si">}</span><span class="s1">2_L2A_CLIPPED/'</span>
<span class="n">masked_path</span>    <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">work_path</span><span class="si">}</span><span class="s1">3_L2A_MASKED/'</span>

<span class="n">Path</span><span class="p">(</span><span class="n">resampled_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Path</span><span class="p">(</span><span class="n">clipped_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Path</span><span class="p">(</span><span class="n">masked_path</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Set-region-of-interest">
<h2>Set region of interest<a class="headerlink" href="#Set-region-of-interest" title="Permalink to this headline">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crs</span> <span class="o">=</span> <span class="s1">'EPSG:32631'</span>

<span class="n">roi_name</span>     <span class="o">=</span> <span class="s1">'extent_roi'</span>
<span class="n">roi_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">roi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">crs</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="si">}</span><span class="s1">.shp'</span>
<span class="n">roi_file</span>     <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">roi_path</span><span class="si">}{</span><span class="n">roi_filename</span><span class="si">}</span><span class="s1">'</span>

<span class="n">roi_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">roi_file</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'ROI shapefile : </span><span class="si">{</span><span class="n">roi_file</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ROI shapefile : /export/miro/ndeffense/LBRAT2104/GROUP_X/WORK/ROI/extent_roi_32631.shp
</pre></div></div>
</div>
</section>
<section id="Select-reflectance-bands-you-want-to-work-with">
<h2>Select reflectance bands you want to work with<a class="headerlink" href="#Select-reflectance-bands-you-want-to-work-with" title="Permalink to this headline">#</a></h2>
<section id="10-metre-spatial-resolution">
<h3>10 metre spatial resolution<a class="headerlink" href="#10-metre-spatial-resolution" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>B2 - Blue</p></li>
<li><p>B3 - Green</p></li>
<li><p>B4 - Red</p></li>
<li><p>B8 - Near Infra-Red (NIR)</p></li>
</ul>
</section>
<section id="20-metre-spatial-resolution">
<span id="metre-spatial-resolution-1"></span><h3>20 metre spatial resolution<a class="headerlink" href="#20-metre-spatial-resolution" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>B5 - Red-Edge</p></li>
<li><p>B6 - Red-Edge</p></li>
<li><p>B7 - Red-Edge</p></li>
<li><p>B8a - Near Infra-Red (NIR)</p></li>
<li><p>B11 - Short Wave Infra-Red (SWIR)</p></li>
<li><p>B12 - Short Wave Infra-Red (SWIR)</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">band_10m_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B02'</span><span class="p">,</span><span class="s1">'B03'</span><span class="p">,</span><span class="s1">'B04'</span><span class="p">,</span><span class="s1">'B08'</span><span class="p">]</span>

<span class="n">band_20m_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B11'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Set-parameters">
<h2>Set parameters<a class="headerlink" href="#Set-parameters" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We will upscale the image by 2: 20m --&gt; 10m</span>
<span class="n">upscale_factor</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># As SCL is categorical data, we MUST use "nearest neighbor" resampling method</span>
<span class="n">resampling_method_categorical</span> <span class="o">=</span> <span class="n">Resampling</span><span class="o">.</span><span class="n">nearest</span>

<span class="c1"># As BOA is continuous data, we can use other resampling methods : nearest, bilinear, cubic</span>
<span class="n">resampling_method_continuous</span> <span class="o">=</span> <span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span>

<span class="n">nodata_val</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000</span>
</pre></div>
</div>
</div>
</section>
<section id="Get-the-list-of-Sentinel-2-data-that-will-be-preprocessed">
<h2>Get the list of Sentinel-2 data that will be preprocessed<a class="headerlink" href="#Get-the-list-of-Sentinel-2-data-that-will-be-preprocessed" title="Permalink to this headline">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_L2A</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">dwl_path</span><span class="si">}</span><span class="s1">S2*.SAFE'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_L2A</span><span class="p">)</span><span class="si">}</span><span class="s1"> L2A will be pre-processed </span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">L2A_safe</span> <span class="ow">in</span> <span class="n">list_L2A</span><span class="p">:</span>
    <span class="n">L2A_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">L2A_safe</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">L2A_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12 L2A will be pre-processed

S2A_MSIL2A_20200417T104021_N0214_R008_T31UFS_20200417T112906.SAFE
S2A_MSIL2A_20200520T105031_N0214_R051_T31UFS_20200520T134332.SAFE
S2A_MSIL2A_20200719T105031_N0214_R051_T31UFS_20200719T134605.SAFE
S2A_MSIL2A_20200914T104031_N0214_R008_T31UFS_20200914T133417.SAFE
S2B_MSIL2A_20200116T105309_N0213_R051_T31UFS_20200116T122813.SAFE
S2B_MSIL2A_20200212T104049_N0214_R008_T31UFS_20200213T134833.SAFE
S2B_MSIL2A_20200316T104709_N0214_R051_T31UFS_20200316T135256.SAFE
S2B_MSIL2A_20200621T103629_N0214_R008_T31UFS_20200621T140338.SAFE
S2B_MSIL2A_20200813T104629_N0214_R051_T31UFS_20200813T133458.SAFE
S2B_MSIL2A_20201019T103959_N0214_R008_T31UFS_20201019T140516.SAFE
S2B_MSIL2A_20201118T104329_N0214_R008_T31UFS_20201118T123717.SAFE
S2B_MSIL2A_20201218T104349_N0214_R008_T31UFS_20201218T124059.SAFE
</pre></div></div>
</div>
</section>
<section id="1.-Resample-images-at-20m-resolution-to-10m">
<h2>1. Resample images at 20m resolution to 10m<a class="headerlink" href="#1.-Resample-images-at-20m-resolution-to-10m" title="Permalink to this headline">#</a></h2>
<section id="1.1-Resample-Scene-Classification-map">
<h3>1.1 Resample Scene Classification map<a class="headerlink" href="#1.1-Resample-Scene-Classification-map" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><p><strong>WARNING</strong>: Only if you are planning to work at 10m resolution. If you are planning to work at 20m resolution, you can skip this step!</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">L2A_safe</span> <span class="ow">in</span> <span class="n">list_L2A</span><span class="p">:</span>

    <span class="n">im_file_20m</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">L2A_safe</span><span class="si">}</span><span class="s1">/GRANULE/*/IMG_DATA/R20m/*_SCL_20m.jp2'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">im_file_20m</span> <span class="o">=</span> <span class="n">im_file_20m</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">)</span>

    <span class="n">im_file_10m</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">resampled_path</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">im_file_20m</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"20m"</span><span class="p">,</span><span class="s2">"10m"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"jp2"</span><span class="p">,</span><span class="s2">"tif"</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">im_file_10m</span><span class="p">):</span>

        <span class="c1"># Open file</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_20m</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">'JP2OpenJPEG'</span><span class="p">)</span>

        <span class="c1"># Resample data to target shape</span>
        <span class="n">resampled_data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">out_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                                               <span class="nb">int</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">upscale_factor</span><span class="p">),</span>
                                               <span class="nb">int</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">upscale_factor</span><span class="p">)</span>
                                               <span class="p">),</span>
                                  <span class="n">resampling</span> <span class="o">=</span> <span class="n">resampling_method_categorical</span><span class="p">)</span>

        <span class="c1"># Scale image transform</span>
        <span class="n">new_transform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span> <span class="o">*</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
            <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">resampled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">resampled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># Update metadata</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span> <span class="o">=</span> <span class="s1">'GTiff'</span><span class="p">,</span>
                       <span class="n">width</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">upscale_factor</span><span class="p">,</span>
                       <span class="n">height</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">upscale_factor</span><span class="p">,</span>
                       <span class="n">transform</span> <span class="o">=</span> <span class="n">new_transform</span><span class="p">)</span>


        <span class="c1"># Write resampled image</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_10m</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resampled_data</span><span class="p">)</span>

        <span class="c1"># Close rasterio objects</span>
        <span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'--&gt; A new resampled raster file is created : </span><span class="si">{</span><span class="n">im_file_10m</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'--&gt; All SCL are resampled !'</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--&gt; All SCL are resampled !
</pre></div></div>
</div>
</section>
<section id="1.2-Resample-Bottom-Of-Atmosphere-corrected-reflectance">
<h3>1.2 Resample Bottom-Of-Atmosphere corrected reflectance<a class="headerlink" href="#1.2-Resample-Bottom-Of-Atmosphere-corrected-reflectance" title="Permalink to this headline">#</a></h3>
<p>If you work only with Blue (B02), Green (B03), Red (B04) and NIR (B08) bands, you don’t have to do the resampling step because theses reflectances are already available at 10m resolution.</p>
<p>This step is only necessary if you work with bands 5,6,7,8A,11,12 which are only available at 20m resolution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">L2A_safe</span> <span class="ow">in</span> <span class="n">list_L2A</span><span class="p">:</span>

    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">band_20m_list</span><span class="p">:</span>

        <span class="n">im_file_20m</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">L2A_safe</span><span class="si">}</span><span class="s1">/GRANULE/*/IMG_DATA/R20m/*</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s1">_20m.jp2'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">im_file_20m</span> <span class="o">=</span> <span class="n">im_file_20m</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">)</span>

        <span class="n">im_file_10m</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">resampled_path</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">im_file_20m</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"20m"</span><span class="p">,</span><span class="s2">"10m"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"jp2"</span><span class="p">,</span><span class="s2">"tif"</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">im_file_10m</span><span class="p">):</span>

            <span class="c1"># Open file</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_20m</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">'JP2OpenJPEG'</span><span class="p">)</span>

            <span class="c1"># Resample data to target shape</span>
            <span class="n">resampled_data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">out_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                                                   <span class="nb">int</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">upscale_factor</span><span class="p">),</span>
                                                   <span class="nb">int</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">upscale_factor</span><span class="p">)</span>
                                                   <span class="p">),</span>
                                    <span class="n">resampling</span> <span class="o">=</span> <span class="n">resampling_method_continuous</span><span class="p">)</span>

            <span class="c1"># Scale image transform</span>
            <span class="n">new_transform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span> <span class="o">*</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">resampled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">resampled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="c1"># Update metadata</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span> <span class="o">=</span> <span class="s1">'GTiff'</span><span class="p">,</span>
                           <span class="n">width</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">upscale_factor</span><span class="p">,</span>
                           <span class="n">height</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">upscale_factor</span><span class="p">,</span>
                           <span class="n">transform</span> <span class="o">=</span> <span class="n">new_transform</span><span class="p">)</span>


            <span class="c1"># Write resampled image</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_10m</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resampled_data</span><span class="p">)</span>

            <span class="c1"># Close rasterio objects</span>
            <span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'--&gt; A new resampled raster file is created : </span><span class="si">{</span><span class="n">im_file_10m</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'--&gt; All reflectances are resampled !'</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--&gt; All reflectances are resampled !
</pre></div></div>
</div>
</section>
</section>
<section id="2.-Clip-images-to-the-extent-of-Region-of-Interest">
<h2>2. Clip images to the extent of Region of Interest<a class="headerlink" href="#2.-Clip-images-to-the-extent-of-Region-of-Interest" title="Permalink to this headline">#</a></h2>
<section id="2.1-Get-list-of-all-images-to-clip">
<h3>2.1 Get list of all images to clip<a class="headerlink" href="#2.1-Get-list-of-all-images-to-clip" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><p><strong>WARNING</strong>: All images must be at same spatial resolution !</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_im_to_clip</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">resampled_path</span><span class="si">}</span><span class="s1">*_10m.tif'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">band_10m_list</span><span class="p">:</span>

    <span class="n">list_im_to_clip</span> <span class="o">+=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">dwl_path</span><span class="si">}</span><span class="s1">*.SAFE/GRANULE/*/IMG_DATA/R10m/*</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s1">_10m.jp2'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_im_to_clip</span><span class="p">)</span><span class="si">}</span><span class="s1"> images to clip'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There are 72 images to clip
</pre></div></div>
</div>
<p><strong>Check where the ROI is located in one of the image to clip</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Plot image</span>

<span class="c1"># First image of the list</span>
<span class="c1">#im_file = list_im_to_clip[0]</span>

<span class="c1"># A cloudy image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_im_to_clip</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">xs</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'20200621'</span><span class="p">,</span><span class="s1">'B04'</span><span class="p">])][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
<span class="n">rasterio</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Plot vector</span>
<span class="n">roi_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_sentinel_2_prepro_20_0.png" src="../_images/notebooks_sentinel_2_prepro_20_0.png"/>
</div>
</div>
</section>
<section id="2.2-Crop-images">
<h3>2.2 Crop images<a class="headerlink" href="#2.2-Crop-images" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">im_file</span> <span class="ow">in</span> <span class="n">list_im_to_clip</span><span class="p">:</span>

    <span class="n">im_file_roi</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">clipped_path</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">im_file</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">_ROI.tif'</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">im_file_roi</span><span class="p">):</span>

        <span class="c1"># Open file</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>

        <span class="c1"># Crop the raster to the extent of the shape</span>
        <span class="n">out_image</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">src</span><span class="p">,</span>
                                                      <span class="n">roi_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                                                      <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                      <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Update metadata</span>
        <span class="n">out_meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span>

        <span class="n">out_meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="s1">'GTiff'</span><span class="p">,</span>
                        <span class="n">width</span> <span class="o">=</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">height</span> <span class="o">=</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">transform</span> <span class="o">=</span> <span class="n">out_transform</span><span class="p">)</span>

        <span class="c1"># Write clipped image</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_roi</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="o">**</span><span class="n">out_meta</span><span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_image</span><span class="p">)</span>

        <span class="c1"># Close rasterio objects</span>
        <span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'A new raster file is created : </span><span class="si">{</span><span class="n">im_file_roi</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'--&gt; All images are clipped !'</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--&gt; All images are clipped !
</pre></div></div>
</div>
<p><strong>Check if clipped image is located inside the ROI</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Plot image</span>

<span class="c1"># First image of the list</span>
<span class="c1">#im_file = glob.glob(f'{clipped_path}*_B*.tif')[0]</span>

<span class="c1"># A cloudy image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">clipped_path</span><span class="si">}</span><span class="s1">*20200621*B04*.tif'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
<span class="n">rasterio</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Plot vector</span>
<span class="n">roi_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_sentinel_2_prepro_24_0.png" src="../_images/notebooks_sentinel_2_prepro_24_0.png"/>
</div>
</div>
</section>
</section>
<section id="3.-Apply-Scene-Classification-map-(SCL)-on-reflectance-images-to-mask-invalid-pixels">
<h2>3. Apply Scene Classification map (SCL) on reflectance images to mask invalid pixels<a class="headerlink" href="#3.-Apply-Scene-Classification-map-(SCL)-on-reflectance-images-to-mask-invalid-pixels" title="Permalink to this headline">#</a></h2>
<section id="3.1-Get-a-list-with-all-reflectance-bands-clipped-on-the-ROI">
<h3>3.1 Get a list with all reflectance bands clipped on the ROI<a class="headerlink" href="#3.1-Get-a-list-with-all-reflectance-bands-clipped-on-the-ROI" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_im_ROI</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">clipped_path</span><span class="si">}</span><span class="s1">*_B*_ROI.tif'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_im_ROI</span><span class="p">)</span><span class="si">}</span><span class="s1"> images where we have to apply SCL map'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There are 60 images where we have to apply SCL map
</pre></div></div>
</div>
</section>
<section id="3.2-Apply-SCL">
<h3>3.2 Apply SCL<a class="headerlink" href="#3.2-Apply-SCL" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">im_file</span> <span class="ow">in</span> <span class="n">list_im_ROI</span><span class="p">:</span>

    <span class="c1"># Get date of image</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">im_file</span><span class="p">)[</span><span class="mi">7</span><span class="p">:</span><span class="mi">7</span><span class="o">+</span><span class="mi">15</span><span class="p">]</span>

    <span class="c1"># Find SCL corresponding to the given reflectances image</span>
    <span class="n">scl_file</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">clipped_path</span><span class="si">}</span><span class="s1">*</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">*SCL_10m_ROI.tif'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">scl_file</span> <span class="o">=</span> <span class="n">scl_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\\</span><span class="s1">'</span><span class="p">,</span><span class="s1">'/'</span><span class="p">)</span>

    <span class="n">im_file_scl</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">masked_path</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">im_file</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">_SCL.tif'</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">im_file_scl</span><span class="p">):</span>

        <span class="c1"># Open SCL and change invalid pixels categories by NaN</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">scl_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>

        <span class="c1"># Read file as numpy array</span>
        <span class="n">SCL</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1">#print('Scene Classification map')</span>
        <span class="c1">#show(SCL, cmap='Set3')</span>

        <span class="n">SCL</span> <span class="o">=</span> <span class="n">SCL</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># No data</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># Saturated or defective</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># Dark area pixels</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># Cloud shadows</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># Vegetation</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># Not vegetated</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># Water</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># Unclassified</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># Cloud medium probability</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>    <span class="c1"># Cloud high probability</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>   <span class="c1"># Thin cirrus</span>
        <span class="n">SCL</span><span class="p">[</span><span class="n">SCL</span> <span class="o">==</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>   <span class="c1"># Snow</span>

        <span class="c1"># Open file</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>

        <span class="c1"># Read file as numpy array</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Update metadata</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>  <span class="c1"># Set to int16 it is lighter than float</span>
                       <span class="n">nodata</span><span class="o">=</span><span class="n">nodata_val</span><span class="p">,</span>     <span class="c1"># Set nodata value in metadata</span>
                       <span class="n">compress</span><span class="o">=</span><span class="s1">'lzw'</span><span class="p">)</span>        <span class="c1"># Compression option</span>

        <span class="c1"># Mask image reflectance with SCL</span>
        <span class="n">im_SLC</span> <span class="o">=</span> <span class="n">im</span> <span class="o">*</span> <span class="n">SCL</span>

        <span class="c1"># Change numpy NaN by nodata_val (e.g. -10000)</span>
        <span class="n">im_SLC</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">im_SLC</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nodata_val</span>

        <span class="c1"># Change the array's type : from float to integer 16</span>
        <span class="n">im_SLC</span> <span class="o">=</span> <span class="n">im_SLC</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>

        <span class="c1"># Write image</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_scl</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">im_SLC</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Close rasterio objects</span>
        <span class="n">src</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'A new raster file is created : </span><span class="si">{</span><span class="n">im_file_scl</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">'--&gt; SCL is applied on all images !'</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--&gt; SCL is applied on all images !
</pre></div></div>
</div>
<p><strong>Check if the SCL was correctly applied</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>


<span class="n">im_file_clip</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">clipped_path</span><span class="si">}</span><span class="s1">*20200621*B04*.tif'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_clip</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
<span class="n">rasterio</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Greys_r'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Before SCL"</span><span class="p">)</span>


<span class="n">im_file_scl</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">masked_path</span><span class="si">}</span><span class="s1">*20200621*B04*.tif'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im_file_scl</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
<span class="n">rasterio</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Greys_r'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"After SCL"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_sentinel_2_prepro_31_0.png" src="../_images/notebooks_sentinel_2_prepro_31_0.png"/>
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Nicolas Deffense
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Preprocessing Sentinel-2 images</a><ul>
<li><a class="reference internal" href="#Set-directory">Set directory</a></li>
<li><a class="reference internal" href="#Set-region-of-interest">Set region of interest</a></li>
<li><a class="reference internal" href="#Select-reflectance-bands-you-want-to-work-with">Select reflectance bands you want to work with</a><ul>
<li><a class="reference internal" href="#10-metre-spatial-resolution">10 metre spatial resolution</a></li>
<li><a class="reference internal" href="#20-metre-spatial-resolution">20 metre spatial resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Set-parameters">Set parameters</a></li>
<li><a class="reference internal" href="#Get-the-list-of-Sentinel-2-data-that-will-be-preprocessed">Get the list of Sentinel-2 data that will be preprocessed</a></li>
<li><a class="reference internal" href="#1.-Resample-images-at-20m-resolution-to-10m">1. Resample images at 20m resolution to 10m</a><ul>
<li><a class="reference internal" href="#1.1-Resample-Scene-Classification-map">1.1 Resample Scene Classification map</a></li>
<li><a class="reference internal" href="#1.2-Resample-Bottom-Of-Atmosphere-corrected-reflectance">1.2 Resample Bottom-Of-Atmosphere corrected reflectance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.-Clip-images-to-the-extent-of-Region-of-Interest">2. Clip images to the extent of Region of Interest</a><ul>
<li><a class="reference internal" href="#2.1-Get-list-of-all-images-to-clip">2.1 Get list of all images to clip</a></li>
<li><a class="reference internal" href="#2.2-Crop-images">2.2 Crop images</a></li>
</ul>
</li>
<li><a class="reference internal" href="#3.-Apply-Scene-Classification-map-(SCL)-on-reflectance-images-to-mask-invalid-pixels">3. Apply Scene Classification map (SCL) on reflectance images to mask invalid pixels</a><ul>
<li><a class="reference internal" href="#3.1-Get-a-list-with-all-reflectance-bands-clipped-on-the-ROI">3.1 Get a list with all reflectance bands clipped on the ROI</a></li>
<li><a class="reference internal" href="#3.2-Apply-SCL">3.2 Apply SCL</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>